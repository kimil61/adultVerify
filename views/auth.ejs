<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì„±ì¸ì¸ì¦</title>
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- í¬íŠ¸ì› SDK -->
  <script src="https://cdn.iamport.kr/v1/iamport.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .container {
      background: white;
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
      max-width: 450px;
      width: 90%;
      text-align: center;
    }
    
    .logo {
      font-size: 48px;
      margin-bottom: 20px;
    }
    
    h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 28px;
    }
    
    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 16px;
      line-height: 1.5;
    }
    
    .warning-box {
      background: #fff3cd;
      border: 1px solid #ffc107;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 30px;
    }
    
    .warning-box p {
      color: #856404;
      font-size: 14px;
      line-height: 1.5;
    }
    
    .test-mode-box {
      background: #d4edda;
      border: 1px solid #28a745;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 20px;
    }
    
    .test-mode-box p {
      color: #155724;
      font-size: 14px;
      line-height: 1.5;
      font-weight: 600;
    }
    
    .btn-verify {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 15px 40px;
      font-size: 18px;
      border-radius: 30px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      font-weight: 600;
      width: 100%;
      margin-bottom: 10px;
    }
    
    .btn-verify:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
    }
    
    .btn-verify:active {
      transform: translateY(0);
    }
    
    .btn-test {
      background: #28a745;
      color: white;
      border: none;
      padding: 12px 30px;
      font-size: 16px;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.2s;
      font-weight: 500;
      width: 100%;
    }
    
    .btn-test:hover {
      background: #218838;
      transform: translateY(-1px);
    }
    
    .info {
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid #eee;
      color: #999;
      font-size: 13px;
    }
    
    .loading {
      display: none;
      margin-top: 20px;
    }
    
    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo">ğŸ”</div>
    <h1>ì„±ì¸ì¸ì¦</h1>
    <p class="subtitle">
      ë³¸ ì„œë¹„ìŠ¤ëŠ” ë§Œ 19ì„¸ ì´ìƒë§Œ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.<br>
      ë³¸ì¸ì¸ì¦ì„ í†µí•´ ì—°ë ¹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.
    </p>
    
    <% if (testMode) { %>
    <div class="test-mode-box">
      <p>ğŸ§ª í…ŒìŠ¤íŠ¸ ëª¨ë“œê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤</p>
    </div>
    <% } %>
    
    <div class="warning-box">
      <p>
        âš ï¸ ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ëŠ” ìˆ˜ì§‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.<br>
        ë³¸ì¸ì¸ì¦ ì •ë³´ëŠ” ì—°ë ¹ í™•ì¸ ìš©ë„ë¡œë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤.
      </p>
    </div>
    
    <% if (testMode) { %>
    <button id="btnTestMode" class="btn-test">í…ŒìŠ¤íŠ¸ ëª¨ë“œë¡œ ì§„ì…</button>
    <% } else { %>
    <button id="btnVerify" class="btn-verify">ë³¸ì¸ì¸ì¦ í•˜ê¸°</button>
    <% } %>
    
    <div class="loading">
      <div class="spinner"></div>
      <p style="margin-top: 10px; color: #666;">ì¸ì¦ ì²˜ë¦¬ ì¤‘...</p>
    </div>
    
    <div class="info">
      <% if (testMode) { %>
      í…ŒìŠ¤íŠ¸ ëª¨ë“œì—ì„œëŠ” ì‹¤ì œ ì¸ì¦ ì—†ì´ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.
      <% } else { %>
      íœ´ëŒ€í° ë³¸ì¸ì¸ì¦ì„ í†µí•´ ì•ˆì „í•˜ê²Œ í™•ì¸í•©ë‹ˆë‹¤.
      <% } %>
    </div>
  </div>

  <script>
    <% if (!testMode) { %>
    // ì‹¤ì œ PortOne ì¸ì¦ ëª¨ë“œ
    const IMP = window.IMP;
    IMP.init('<%= impKey %>');
    
    document.getElementById('btnVerify').addEventListener('click', function() {
      // ë³¸ì¸ì¸ì¦ ìš”ì²­
      IMP.certification({
        popup: true // PCì—ì„œëŠ” íŒì—…, ëª¨ë°”ì¼ì—ì„œëŠ” ë¦¬ë‹¤ì´ë ‰ì…˜
      }, function(rsp) {
        if (rsp.success) {
          // ì¸ì¦ ì„±ê³µ
          $('.loading').show();
          $('#btnVerify').hide();
          
          // ì„œë²„ì— ì¸ì¦ ì •ë³´ ì „ì†¡
          $.ajax({
            url: '/auth/verify',
            method: 'POST',
            data: {
              imp_uid: rsp.imp_uid,
              success: true
            },
            success: function(result) {
              $('.loading').hide();
              
              if (result.success) {
                alert(result.message);
                window.location.href = result.redirect;
              } else {
                alert(result.message);
                $('#btnVerify').show();
              }
            },
            error: function() {
              $('.loading').hide();
              alert('ì„œë²„ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
              $('#btnVerify').show();
            }
          });
        } else {
          // ì¸ì¦ ì‹¤íŒ¨ ë˜ëŠ” ì·¨ì†Œ
          alert('ë³¸ì¸ì¸ì¦ì„ ì·¨ì†Œí•˜ì…¨ìŠµë‹ˆë‹¤.');
        }
      });
    });
    <% } else { %>
    // í…ŒìŠ¤íŠ¸ ëª¨ë“œ
    document.getElementById('btnTestMode').addEventListener('click', function() {
      $('.loading').show();
      $('#btnTestMode').hide();
      
      // í…ŒìŠ¤íŠ¸ ëª¨ë“œë¡œ ì„œë²„ì— ìš”ì²­
      $.ajax({
        url: '/auth/verify',
        method: 'POST',
        data: {
          imp_uid: 'test_mode',
          success: true
        },
        success: function(result) {
          $('.loading').hide();
          
          if (result.success) {
            alert(result.message);
            window.location.href = result.redirect;
          } else {
            alert(result.message);
            $('#btnTestMode').show();
          }
        },
        error: function() {
          $('.loading').hide();
          alert('ì„œë²„ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
          $('#btnTestMode').show();
        }
      });
    });
    <% } %>
  </script>
</body>
</html>